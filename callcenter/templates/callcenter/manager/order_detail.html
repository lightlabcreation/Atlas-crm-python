{% extends 'base.html' %}
{% load static %}

{% block title %}Order Detail #{{ order.id }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-amber-50/30 to-yellow-50/20">
    <!-- Enhanced Page Header -->
    <div class="bg-gradient-to-r from-amber-500 to-yellow-600 shadow-2xl border-b-4 border-amber-400">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
                <div class="space-y-2">
                    <div class="flex items-center gap-3">
                        <a href="{% url 'callcenter:manager_order_list' %}" class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center hover:bg-white/30 transition-all duration-200" title="Back to Orders">
                            <i class="fas fa-arrow-left text-white text-lg"></i>
                        </a>
                        <div class="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
                            <i class="fas fa-file-alt text-white text-xl"></i>
                        </div>
                        <div>
                            <h1 class="text-4xl font-bold text-white">Order #{{ order.id }}</h1>
                            <p class="text-amber-100 text-lg">Detailed order information and management</p>
                        </div>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row gap-3">
                    <button onclick="openEditStatusModal()" class="inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 border border-yellow-400/20">
                        <i class="fas fa-edit mr-2"></i>
                        Edit Status
                    </button>
                    <button onclick="openEditOrderModal()" class="inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 border border-blue-400/20">
                        <i class="fas fa-edit mr-2"></i>
                        Edit Order
                    </button>
                    <a href="{% url 'callcenter:order_status_log' order.id %}" class="inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 border border-purple-400/20">
                        <i class="fas fa-history mr-2"></i>
                        Status Log
                    </a>
                    {% if not order.escalated_to_manager %}
                    <button onclick="escalateOrder()" class="inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 border border-red-400/20">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Escalate to Manager
                    </button>
                    {% endif %}
                    {% if not order.agent %}
                    <a href="{% url 'callcenter:manager_assign_order' order.id %}" class="inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 border border-green-400/20">
                        <i class="fas fa-user-plus mr-2"></i>
                        Assign Order
                    </a>
                    {% else %}
                    <a href="{% url 'callcenter:manager_reassign_order' order.id %}" class="inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-amber-500 to-yellow-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 border border-amber-400/20">
                        <i class="fas fa-exchange-alt mr-2"></i>
                        Reassign Order
                    </a>
                    {% endif %}
                    <a href="{% url 'callcenter:manager_order_list' %}" class="inline-flex items-center justify-center px-6 py-3 bg-white/20 backdrop-blur-sm text-white font-semibold rounded-xl hover:bg-white/30 transition-all duration-200 border border-white/30">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Back to Orders
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <!-- Escalation Information -->
        {% if order.escalated_to_manager %}
        <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-xl shadow-lg mb-8">
            <div class="px-6 py-4">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4">
                        <i class="fas fa-exclamation-triangle text-white text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-white">‚ö†Ô∏è Order Escalated to Manager</h3>
                        <p class="text-red-100 text-sm">This order requires your immediate attention</p>
                    </div>
                </div>
            </div>
            <div class="px-6 pb-6">
                <div class="bg-white bg-opacity-10 rounded-lg p-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm text-red-100 mb-1">Escalated by:</p>
                            <p class="text-white font-semibold">{{ order.escalated_by.get_full_name|default:order.escalated_by.username }}</p>
                        </div>
                        <div>
                            <p class="text-sm text-red-100 mb-1">Escalated on:</p>
                            <p class="text-white font-semibold">{{ order.escalated_at|date:"M d, Y H:i" }}</p>
                        </div>
                    </div>
                    {% if order.escalation_reason %}
                    <div class="mt-4">
                        <p class="text-sm text-red-100 mb-2 font-semibold">üìù Escalation Reason:</p>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4 border border-white border-opacity-30">
                            <p class="text-white leading-relaxed text-base font-medium">{{ order.escalation_reason }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Manager Actions Section -->
        <div class="bg-gradient-to-r from-blue-500 to-indigo-600 rounded-xl shadow-lg mb-8">
            <div class="px-6 py-4">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4">
                        <i class="fas fa-user-tie text-white text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-white">Manager Actions</h3>
                        <p class="text-blue-100 text-sm">Available actions for this order</p>
                    </div>
                </div>
            </div>
            <div class="px-6 pb-6">
                <div class="bg-white bg-opacity-10 rounded-lg p-4">
                    {% if order.escalated_to_manager %}
                        <div class="text-center py-4">
                            <i class="fas fa-exclamation-triangle text-yellow-300 text-2xl mb-2"></i>
                            <p class="text-white font-semibold">This order has been escalated and requires your attention</p>
                            <p class="text-blue-100 text-sm mt-1">Please review the escalation details above and take appropriate action</p>
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-check-circle text-green-300 text-2xl mb-2"></i>
                            <p class="text-white font-semibold">This order is not escalated</p>
                            <p class="text-blue-100 text-sm mt-1">You can escalate it if needed using the button above</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Enhanced Order Information -->
        <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 overflow-hidden mb-8">
            <div class="bg-gradient-to-r from-slate-800 to-slate-900 px-6 py-6 border-b border-slate-600/50">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-xl flex items-center justify-center mr-4">
                        <i class="fas fa-info-circle text-slate-900 text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-white">Order Information</h3>
                        <p class="text-slate-300 text-sm">Complete order details and status</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div>
                        <h4 class="text-lg font-semibold text-slate-900 mb-4">Customer Information</h4>
                        <dl class="space-y-3">
                            <div>
                                <dt class="text-sm font-medium text-slate-600">Order ID</dt>
                                <dd class="text-sm font-semibold text-slate-900">#{{ order.id }}</dd>
                            </div>
                            <div>
                                <dt class="text-sm font-medium text-slate-600">Customer Name</dt>
                                <dd class="text-sm font-semibold text-slate-900">{{ order.customer|default:"No Customer" }}</dd>
                            </div>
                            <div>
                                <dt class="text-sm font-medium text-slate-600">Phone</dt>
                                <dd class="text-sm font-semibold text-slate-900">{{ order.customer_phone|default:"No Phone" }}</dd>
                            </div>
                            <div>
                                <dt class="text-sm font-medium text-slate-600">Email</dt>
                                <dd class="text-sm font-semibold text-slate-900">{{ order.customer_email|default:"No Email" }}</dd>
                            </div>
                            {% if order.shipping_address or order.emirate or order.region or order.city %}
                            <div>
                                <dt class="text-sm font-medium text-slate-600">Address</dt>
                                <dd class="text-sm font-semibold text-slate-900">
                                    {% if order.shipping_address %}
                                        {{ order.shipping_address }}
                                    {% elif order.region and order.emirate %}
                                        {{ order.region }}, {{ order.emirate }}
                                    {% elif order.city %}
                                        {{ order.city }}
                                    {% else %}
                                        No Address
                                    {% endif %}
                                </dd>
                            </div>
                            {% endif %}
                        </dl>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-slate-900 mb-4">Order Status</h4>
                        <dl class="space-y-3">
                            <div>
                                <dt class="text-sm font-medium text-slate-600">Status</dt>
                                <dd class="text-sm font-semibold text-slate-900">
                                    {% if order.status == 'pending' %}
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-amber-100 text-amber-800 border border-amber-200 shadow-sm">
                                            Pending
                                        </span>
                                    {% elif order.status == 'assigned' %}
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800 border border-blue-200 shadow-sm">
                                            Assigned
                                        </span>
                                    {% elif order.status == 'in_progress' %}
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800 border border-purple-200 shadow-sm">
                                            In Progress
                                        </span>
                                    {% elif order.status == 'completed' %}
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 border border-green-200 shadow-sm">
                                            Completed
                                        </span>
                                    {% elif order.status == 'cancelled' %}
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800 border border-red-200 shadow-sm">
                                            Cancelled
                                        </span>
                                    {% else %}
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-slate-100 text-slate-800 border border-slate-200 shadow-sm">
                                            {{ order.status|title }}
                                        </span>
                                    {% endif %}
                                </dd>
                            </div>
                            <div>
                                <dt class="text-sm font-medium text-slate-600">Priority</dt>
                                <dd class="text-sm font-semibold text-slate-900">
                                    {% if order.priority == 'high' %}
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800 border border-red-200 shadow-sm">
                                            High
                                        </span>
                                    {% elif order.priority == 'medium' %}
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-amber-100 text-amber-800 border border-amber-200 shadow-sm">
                                            Medium
                                        </span>
                                    {% elif order.priority == 'low' %}
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 border border-green-200 shadow-sm">
                                            Low
                                        </span>
                                    {% else %}
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-slate-100 text-slate-800 border border-slate-200 shadow-sm">
                                            Normal
                                        </span>
                                    {% endif %}
                                </dd>
                            </div>
                            <div>
                                <dt class="text-sm font-medium text-slate-600">Created</dt>
                                <dd class="text-sm font-semibold text-slate-900">{{ order.created_at|date:"M d, Y H:i" }}</dd>
                            </div>
                            <div>
                                <dt class="text-sm font-medium text-slate-600">Updated</dt>
                                <dd class="text-sm font-semibold text-slate-900">{{ order.updated_at|date:"M d, Y H:i" }}</dd>
                            </div>
                        </dl>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-slate-900 mb-4">Financial Details</h4>
                        <dl class="space-y-3">
                            <div>
                                <dt class="text-sm font-medium text-slate-600">Total Amount</dt>
                                <dd class="text-sm font-semibold text-slate-900">{{ order.total_price|floatformat:2 }} AED</dd>
                            </div>
                            <div>
                                <dt class="text-sm font-medium text-slate-600">Items Count</dt>
                                <dd class="text-sm font-semibold text-slate-900">{{ order.items.count }} items</dd>
                            </div>
                            <div>
                                <dt class="text-sm font-medium text-slate-600">Payment Status</dt>
                                <dd class="text-sm font-semibold text-slate-900">
                                    {% if order.payment_status == 'paid' %}
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 border border-green-200 shadow-sm">
                                            Paid
                                        </span>
                                    {% elif order.payment_status == 'pending' %}
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-amber-100 text-amber-800 border border-amber-200 shadow-sm">
                                            Pending
                                        </span>
                                    {% else %}
                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-slate-100 text-slate-800 border border-slate-200 shadow-sm">
                                            {{ order.payment_status|title|default:"Unknown" }}
                                        </span>
                                    {% endif %}
                                </dd>
                            </div>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Agent Assignment -->
        <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 overflow-hidden mb-8">
            <div class="bg-gradient-to-r from-slate-800 to-slate-900 px-6 py-6 border-b border-slate-600/50">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-xl flex items-center justify-center mr-4">
                        <i class="fas fa-user text-slate-900 text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-white">Agent Assignment</h3>
                        <p class="text-slate-300 text-sm">Current agent and assignment details</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        {% if order.agent %}
                        <div class="w-16 h-16 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-full flex items-center justify-center mr-4">
                            <span class="text-xl font-bold text-slate-900">{{ order.agent.get_full_name|first|upper }}</span>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold text-slate-900">{{ order.agent.get_full_name }}</h4>
                            <p class="text-slate-600">{{ order.agent.email }}</p>
                            <p class="text-sm text-slate-500">Agent ID: {{ order.agent.id }}</p>
                        </div>
                        {% else %}
                        <div class="w-16 h-16 bg-gray-300 rounded-full flex items-center justify-center mr-4">
                            <span class="text-xl font-bold text-gray-600">?</span>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold text-gray-600">No Agent Assigned</h4>
                            <p class="text-gray-500">This order has not been assigned to an agent yet</p>
                        </div>
                        {% endif %}
                    </div>
                    <div class="text-right">
                        <div class="flex flex-col space-y-2">
                            <a href="{% url 'callcenter:manager_reassign_order' order.id %}" class="inline-flex items-center justify-center px-4 py-2 bg-gradient-to-r from-amber-500 to-yellow-600 text-white font-semibold rounded-lg hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200 border border-amber-400/20">
                                <i class="fas fa-exchange-alt mr-2"></i>
                                Reassign
                            </a>
                            <span class="text-xs text-slate-500">Assigned on {{ order.assigned_at|date:"M d, Y H:i"|default:"Unknown" }}</span>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="text-center py-8">
                    <div class="w-16 h-16 bg-slate-200 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-user-plus text-slate-400 text-2xl"></i>
                    </div>
                    <h4 class="text-lg font-semibold text-slate-900 mb-2">No Agent Assigned</h4>
                    <p class="text-slate-600 mb-4">This order is currently unassigned and waiting for an agent.</p>
                    <a href="{% url 'callcenter:manager_assign_order' order.id %}" class="inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 border border-green-400/20">
                        <i class="fas fa-user-plus mr-2"></i>
                        Assign Order
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Product Details -->
        {% if order.items.exists %}
        <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 overflow-hidden mb-8">
            <div class="bg-gradient-to-r from-blue-800 to-indigo-900 px-6 py-6 border-b border-blue-600/50">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-xl flex items-center justify-center mr-4">
                        <i class="fas fa-box text-white text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-white">Product Details</h3>
                        <p class="text-blue-200 text-sm">Product information for order confirmation</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                {% for item in order.items.all|slice:":1" %}
                <div class="flex items-start space-x-6">
                    <!-- Product Image -->
                    <div class="flex-shrink-0">
                        {% if item.product.image %}
                        <img src="{{ item.product.image.url }}" alt="{{ item.product.name_en }}" class="w-32 h-32 object-cover rounded-xl border-2 border-blue-200 shadow-lg">
                        {% else %}
                        <div class="w-32 h-32 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-xl border-2 border-blue-200 flex items-center justify-center shadow-lg">
                            <i class="fas fa-image text-blue-400 text-3xl"></i>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Product Information -->
                    <div class="flex-1">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <dt class="text-sm font-medium text-slate-500">Product Name (EN)</dt>
                                <dd class="mt-1 text-lg font-semibold text-slate-900">{{ item.product.name_en|default:"N/A" }}</dd>
                            </div>
                            <div>
                                <dt class="text-sm font-medium text-slate-500">Product Name (AR)</dt>
                                <dd class="mt-1 text-lg font-semibold text-slate-900">{{ item.product.name_ar|default:"N/A" }}</dd>
                            </div>
                            <div>
                                <dt class="text-sm font-medium text-slate-500">Product Code</dt>
                                <dd class="mt-1 text-sm text-slate-900 font-mono bg-slate-100 px-2 py-1 rounded">{{ item.product.code|default:"N/A" }}</dd>
                            </div>
                            <div>
                                <dt class="text-sm font-medium text-slate-500">SKU</dt>
                                <dd class="mt-1 text-sm text-slate-900 font-mono bg-slate-100 px-2 py-1 rounded">{{ item.product.sku|default:"N/A" }}</dd>
                            </div>
                            {% if item.product.product_variant %}
                            <div>
                                <dt class="text-sm font-medium text-slate-500">Product Variant</dt>
                                <dd class="mt-1 text-sm text-slate-900">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gradient-to-r from-blue-100 to-indigo-100 text-blue-800 border border-blue-200">
                                        {{ item.product.product_variant }}
                                    </span>
                                </dd>
                            </div>
                            {% endif %}
                            <div>
                                <dt class="text-sm font-medium text-slate-500">Quantity</dt>
                                <dd class="mt-1 text-2xl font-bold text-blue-600">{{ item.quantity }}</dd>
                            </div>
                            <div>
                                <dt class="text-sm font-medium text-slate-500">Unit Price</dt>
                                <dd class="mt-1 text-xl font-bold text-green-600">{{ item.price|floatformat:2 }} AED</dd>
                            </div>
                            <div class="md:col-span-2">
                                <dt class="text-sm font-medium text-slate-500">Total Price</dt>
                                <dd class="mt-1 text-3xl font-bold text-emerald-600">{{ item.subtotal|floatformat:2 }} AED</dd>
                            </div>
                            {% if item.product.product_link %}
                            <div class="md:col-span-2">
                                <dt class="text-sm font-medium text-slate-500">Product Link</dt>
                                <dd class="mt-2">
                                    <div class="text-sm text-slate-600 break-all mb-3 p-3 bg-slate-50 rounded-lg border border-slate-200">
                                        {{ item.product.product_link }}
                                    </div>
                                    <a href="{{ item.product.product_link }}" target="_blank" rel="noopener noreferrer" 
                                       class="inline-flex items-center px-4 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200">
                                        <i class="fas fa-external-link-alt mr-2"></i>
                                        View Product
                                    </a>
                                </dd>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Product Description -->
                        {% if item.product.description_en or item.product.description_ar %}
                        <div class="mt-6">
                            <dt class="text-sm font-medium text-slate-500">Description</dt>
                            <dd class="mt-2 text-sm text-slate-700 bg-slate-50 p-4 rounded-lg">
                                {% if item.product.description_en %}
                                <div class="mb-3">
                                    <strong class="text-blue-600">EN:</strong> {{ item.product.description_en|truncatewords:30 }}
                                </div>
                                {% endif %}
                                {% if item.product.description_ar %}
                                <div>
                                    <strong class="text-blue-600">AR:</strong> {{ item.product.description_ar|truncatewords:30 }}
                                </div>
                                {% endif %}
                            </dd>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
                {% if order.items.count > 1 %}
                <div class="mt-4 text-sm text-slate-600">
                    <i class="fas fa-info-circle mr-2"></i>
                    Showing first product. Total {{ order.items.count }} items in this order.
                </div>
                            {% endif %}
                        </div>
                    </div>
        {% elif order.product %}
        <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 overflow-hidden mb-8">
            <div class="bg-gradient-to-r from-blue-800 to-indigo-900 px-6 py-6 border-b border-blue-600/50">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-xl flex items-center justify-center mr-4">
                        <i class="fas fa-box text-white text-lg"></i>
                </div>
                    <div>
                        <h3 class="text-xl font-bold text-white">Product Details</h3>
                        <p class="text-blue-200 text-sm">Legacy product information</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <p class="text-sm text-slate-600">Product Name: {{ order.product.name_en|default:"N/A" }}</p>
            </div>
        </div>
        {% else %}
        <!-- No Product Information -->
        <div class="bg-yellow-50 border-2 border-yellow-200 rounded-2xl p-6 mb-8">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-yellow-500 text-2xl"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-medium text-yellow-800">
                        No Product Information
                    </h3>
                    <div class="mt-2 text-sm text-yellow-700">
                        <p>This order does not have product information linked. Please contact the seller for product details.</p>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Shipping Information -->
        {% if order.shipping_address or order.emirate or order.region or order.city or order.state %}
        <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 overflow-hidden mb-8">
            <div class="bg-gradient-to-r from-green-800 to-emerald-900 px-6 py-6 border-b border-green-600/50">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-br from-green-400 to-emerald-500 rounded-xl flex items-center justify-center mr-4">
                        <i class="fas fa-map-marker-alt text-white text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-white">Shipping Information</h3>
                        <p class="text-green-200 text-sm">Delivery address and location details</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% if order.shipping_address %}
                    <div class="md:col-span-2">
                        <dt class="text-sm font-medium text-slate-500">Address</dt>
                        <dd class="mt-1 text-sm text-slate-900 bg-slate-50 p-3 rounded-lg">{{ order.shipping_address }}</dd>
                    </div>
                    {% endif %}
                    {% if order.emirate %}
                    <div>
                        <dt class="text-sm font-medium text-slate-500">Emirate</dt>
                        <dd class="mt-1 text-sm text-slate-900">{{ order.emirate }}</dd>
                    </div>
                    {% endif %}
                    {% if order.region %}
                    <div>
                        <dt class="text-sm font-medium text-slate-500">Region</dt>
                        <dd class="mt-1 text-sm text-slate-900">{{ order.region }}</dd>
                    </div>
                    {% endif %}
                    {% if order.city %}
                    <div>
                        <dt class="text-sm font-medium text-slate-500">City</dt>
                        <dd class="mt-1 text-sm text-slate-900">{{ order.city }}</dd>
                    </div>
                    {% endif %}
                    {% if order.state %}
                    <div>
                        <dt class="text-sm font-medium text-slate-500">State</dt>
                        <dd class="mt-1 text-sm text-slate-900">{{ order.state }}</dd>
                    </div>
                    {% endif %}
                    {% if order.zip_code %}
                    <div>
                        <dt class="text-sm font-medium text-slate-500">ZIP Code</dt>
                        <dd class="mt-1 text-sm text-slate-900">{{ order.zip_code }}</dd>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% else %}
        <div class="bg-yellow-50 border-2 border-yellow-200 rounded-2xl p-6 mb-8">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-yellow-500 text-2xl"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-medium text-yellow-800">No Shipping Address</h3>
                    <p class="mt-2 text-sm text-yellow-700">Address information has not been provided for this order.</p>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Enhanced Order Items -->
        <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 overflow-hidden mb-8">
            <div class="bg-gradient-to-r from-slate-800 to-slate-900 px-6 py-6 border-b border-slate-600/50">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-xl flex items-center justify-center mr-4">
                        <i class="fas fa-shopping-cart text-slate-900 text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-white">Order Items</h3>
                        <p class="text-slate-300 text-sm">Products and services in this order</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-slate-200">
                        <thead class="bg-slate-50/50">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Product</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Quantity</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Unit Price</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-700 uppercase tracking-wider">Total</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-slate-200">
                            {% for item in order.items.all %}
                            <tr class="hover:bg-slate-50/50 transition-colors duration-150">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-semibold text-slate-900">{{ item.product.name }}</div>
                                    <div class="text-sm text-slate-500">{{ item.product.description|truncatechars:50 }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900">{{ item.quantity }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900">{{ item.unit_price|floatformat:2 }} AED</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-slate-900">{{ item.total_price|floatformat:2 }} AED</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="px-6 py-12 text-center">
                                    <div class="text-slate-500">
                                        <i class="fas fa-shopping-cart text-4xl mb-4 text-slate-300"></i>
                                        <p class="text-lg font-medium">No items found</p>
                                        <p class="text-sm">This order contains no items</p>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Enhanced Order History -->
        <div class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 overflow-hidden mb-8">
            <div class="bg-gradient-to-r from-slate-800 to-slate-900 px-6 py-6 border-b border-slate-600/50">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-xl flex items-center justify-center mr-4">
                        <i class="fas fa-history text-slate-900 text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-white">Order History</h3>
                        <p class="text-slate-300 text-sm">Timeline of order status changes</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    {% for status_change in order.status_history.all %}
                    <div class="flex items-center space-x-4">
                        <div class="w-8 h-8 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-circle text-slate-900 text-xs"></i>
                        </div>
                        <div class="flex-1">
                            <div class="text-sm font-semibold text-slate-900">{{ status_change.get_status_display }}</div>
                            <div class="text-sm text-slate-500">{{ status_change.changed_at|date:"M d, Y H:i" }}</div>
                            {% if status_change.notes %}
                            <div class="text-sm text-slate-600 mt-1">{{ status_change.notes }}</div>
                            {% endif %}
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center text-slate-500 py-8">
                        <i class="fas fa-history text-2xl mb-2 text-slate-300"></i>
                        <p class="text-sm">No status history available</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Enhanced Quick Actions -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            {% if not order.agent %}
            <a href="{% url 'callcenter:manager_assign_order' order.id %}" class="p-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-2xl hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200 text-center">
                <i class="fas fa-user-plus text-2xl mb-2"></i>
                <div class="text-sm font-semibold">Assign Order</div>
                <div class="text-xs opacity-80">Assign to agent</div>
            </a>
            {% else %}
            <a href="{% url 'callcenter:manager_reassign_order' order.id %}" class="p-4 bg-gradient-to-r from-amber-500 to-yellow-600 text-white rounded-2xl hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200 text-center">
                <i class="fas fa-exchange-alt text-2xl mb-2"></i>
                <div class="text-sm font-semibold">Reassign</div>
                <div class="text-xs opacity-80">Change agent</div>
            </a>
            {% endif %}
            
            <button onclick="viewCustomer()" class="p-4 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-2xl hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200 text-center">
                <i class="fas fa-user text-2xl mb-2"></i>
                <div class="text-sm font-semibold">View Customer</div>
                <div class="text-xs opacity-80">Customer details</div>
            </button>
            
            <button onclick="exportOrder()" class="p-4 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-2xl hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200 text-center">
                <i class="fas fa-download text-2xl mb-2"></i>
                <div class="text-sm font-semibold">Export Order</div>
                <div class="text-xs opacity-80">Download details</div>
            </button>
            
            <button onclick="addNote()" class="p-4 bg-gradient-to-r from-slate-500 to-slate-600 text-white rounded-2xl hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200 text-center">
                <i class="fas fa-sticky-note text-2xl mb-2"></i>
                <div class="text-sm font-semibold">Add Note</div>
                <div class="text-xs opacity-80">Internal notes</div>
            </button>
        </div>
    </div>
</div>

<!-- Product Image Modal -->
<div id="productImageModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-medium text-gray-900" id="modalProductName">Product Image</h3>
                <button onclick="closeProductImage()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="text-center">
                <img id="modalProductImage" src="" alt="" class="max-w-full h-auto rounded-lg border border-gray-200">
            </div>
            
            <div class="flex justify-end space-x-3 mt-6">
                <button onclick="closeProductImage()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Status Modal -->
<div id="editStatusModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-medium text-gray-900">ÿ™ÿπÿØŸäŸÑ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÑÿ®</h3>
                <button onclick="closeEditStatusModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©</label>
                <select id="newStatusSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" onchange="showStatusConfirmation(this.value)">
                    <option value="pending">ŸÅŸä ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± (Pending)</option>
                    <option value="processing">ŸÇŸäÿØ ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ© (Processing)</option>
                    <option value="confirmed">ÿ™ŸÖ ÿßŸÑÿ™ÿ£ŸÉŸäÿØ (Confirmed)</option>
                    <option value="cancelled">ŸÖŸÑÿ∫Ÿä (Cancelled)</option>
                    <option value="no_answer_1st">ŸÑÿß Ÿäÿ±ÿØ - ŸÖÿ≠ÿßŸàŸÑÿ© ÿ£ŸàŸÑŸâ (No Answer 1st)</option>
                    <option value="no_answer_2nd">ŸÑÿß Ÿäÿ±ÿØ - ŸÖÿ≠ÿßŸàŸÑÿ© ÿ´ÿßŸÜŸäÿ© (No Answer 2nd)</option>
                    <option value="no_answer_final">ŸÑÿß Ÿäÿ±ÿØ - ŸÖÿ≠ÿßŸàŸÑÿ© ÿ£ÿÆŸäÿ±ÿ© (No Answer Final)</option>
                    <option value="postponed">ÿ™ÿ£ÿ¨ŸäŸÑ (Postponed)</option>
                    <option value="invalid_number">ÿ±ŸÇŸÖ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ (Invalid Number)</option>
                    <option value="call_back_later">ÿ•ÿπÿßÿØÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ŸÑÿßÿ≠ŸÇÿßŸã (Call Back Later)</option>
                    <option value="escalate_manager">ÿ±ŸÅÿπ ŸÑŸÑŸÖÿØŸäÿ± (Escalate to Manager)</option>
                </select>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">ÿ≥ÿ®ÿ® ÿßŸÑÿ™ÿπÿØŸäŸÑ</label>
                <textarea id="editReason" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500" rows="3" placeholder="ÿßŸÉÿ™ÿ® ÿ≥ÿ®ÿ® ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≠ÿßŸÑÿ©..."></textarea>
            </div>
            
            <div class="flex justify-end space-x-3">
                <button onclick="closeEditStatusModal()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                    Cancel
                </button>
                <button onclick="confirmStatusEdit()" class="px-4 py-2 text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 rounded-md">
                    ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ™ÿπÿØŸäŸÑ
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Order Modal -->
<div id="editOrderModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-10 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white text-gray-900" style="color-scheme: light !important;">
        <div class="mt-3" style="color-scheme: light !important;">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-medium text-gray-900" style="color: #111827 !important;">Edit Order Details</h3>
                <button onclick="closeEditOrderModal()" class="text-gray-400 hover:text-gray-600" style="color: #9CA3AF !important;">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="editOrderForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" style="color: #374151 !important;">Customer Name</label>
                        <input type="text" id="editCustomer" value="{{ order.customer }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="background-color: white !important; color: #111827 !important; border-color: #D1D5DB !important;">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" style="color: #374151 !important;">Phone Number</label>
                        <input type="text" id="editPhone" value="{{ order.customer_phone }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="background-color: white !important; color: #111827 !important; border-color: #D1D5DB !important;">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" style="color: #374151 !important;">Quantity</label>
                        <input type="number" id="editQuantity" value="{{ order.quantity }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="background-color: white !important; color: #111827 !important; border-color: #D1D5DB !important;">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" style="color: #374151 !important;">Price (AED)</label>
                        <input type="number" step="0.01" id="editPrice" value="{{ order.price_per_unit }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="background-color: white !important; color: #111827 !important; border-color: #D1D5DB !important;">
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2" style="color: #374151 !important;">Shipping Address</label>
                    <textarea id="editAddress" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" style="background-color: white !important; color: #111827 !important; border-color: #D1D5DB !important;">{{ order.shipping_address }}</textarea>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" style="color: #374151 !important;">Emirate</label>
                        <select id="editEmirate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="background-color: white !important; color: #111827 !important; border-color: #D1D5DB !important;">
                            <option value="">Select Emirate</option>
                            <option value="abu_dhabi" {% if order.emirate == 'abu_dhabi' %}selected{% endif %}>Abu Dhabi</option>
                            <option value="dubai" {% if order.emirate == 'dubai' %}selected{% endif %}>Dubai</option>
                            <option value="sharjah" {% if order.emirate == 'sharjah' %}selected{% endif %}>Sharjah</option>
                            <option value="ajman" {% if order.emirate == 'ajman' %}selected{% endif %}>Ajman</option>
                            <option value="ras_al_khaimah" {% if order.emirate == 'ras_al_khaimah' %}selected{% endif %}>Ras Al Khaimah</option>
                            <option value="fujairah" {% if order.emirate == 'fujairah' %}selected{% endif %}>Fujairah</option>
                            <option value="umm_al_quwain" {% if order.emirate == 'umm_al_quwain' %}selected{% endif %}>Umm Al Quwain</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" style="color: #374151 !important;">Area</label>
                        <select id="editRegion" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="background-color: white !important; color: #111827 !important; border-color: #D1D5DB !important;">
                            <option value="">ÿßÿÆÿ™ÿ± Area</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" style="color: #374151 !important;">City</label>
                        <input type="text" id="editCity" value="{{ order.city }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="background-color: white !important; color: #111827 !important; border-color: #D1D5DB !important;">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" style="color: #374151 !important;">Area/ÿßŸÑŸàŸÑÿßŸäÿ©</label>
                        <input type="text" id="editState" value="{{ order.state }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="background-color: white !important; color: #111827 !important; border-color: #D1D5DB !important;">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" style="color: #374151 !important;">Postal Code</label>
                        <input type="text" id="editZipCode" value="{{ order.zip_code }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="background-color: white !important; color: #111827 !important; border-color: #D1D5DB !important;">
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2" style="color: #374151 !important;">Additional Contact Number (Optional)</label>
                    <input type="text" id="editAdditionalPhone" placeholder="Additional phone number for the customer" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" style="background-color: white !important; color: #111827 !important; border-color: #D1D5DB !important;">
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="closeEditOrderModal()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md" style="background-color: #F3F4F6 !important; color: #374151 !important;">
                        Cancel
                    </button>
                    <button type="button" onclick="confirmOrderEdit()" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md" style="background-color: #2563EB !important; color: white !important;">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Product Details Modal -->
<div id="productDetailsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-10 mx-auto p-5 border w-full max-w-4xl shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-medium text-gray-900">ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨</h3>
                <button onclick="closeProductDetailsModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div id="productDetailsContent" class="flex items-center justify-center py-8">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                <span class="ml-2 text-gray-600">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨...</span>
            </div>
        </div>
    </div>
</div>

<script>
function openProductImage(imageUrl, productName) {
    document.getElementById('modalProductImage').src = imageUrl;
    document.getElementById('modalProductImage').alt = productName;
    document.getElementById('modalProductName').textContent = productName;
    document.getElementById('productImageModal').classList.remove('hidden');
}

function closeProductImage() {
    document.getElementById('productImageModal').classList.add('hidden');
}

function openProductDetailsModal(productId) {
    document.getElementById('productDetailsModal').classList.remove('hidden');
    
    // Show loading state
    document.getElementById('productDetailsContent').innerHTML = `
        <div class="flex items-center justify-center py-8">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <span class="ml-2 text-gray-600">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨...</span>
        </div>
    `;
    
    // Fetch product details
    console.log('DEBUG: Fetching product details for ID:', productId);
    fetch(`/products/${productId}/api/`)
        .then(response => {
            console.log('DEBUG: Response status:', response.status);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('DEBUG: Response data:', data);
            if (data.success) {
                displayProductDetails(data.product);
            } else {
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨: ' + (data.error || 'ÿÆÿ∑ÿ£ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ'));
            }
        })
        .catch(error => {
            console.error('DEBUG: Fetch error:', error);
            showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿÆÿßÿØŸÖ: ' + error.message);
        });
}

function closeProductDetailsModal() {
    document.getElementById('productDetailsModal').classList.add('hidden');
}

function displayProductDetails(product) {
    const content = `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div>
                ${product.image ? `
                    <img src="${product.image}" alt="${product.name_en}" class="w-full h-64 object-cover rounded-lg shadow-lg">
                ` : `
                    <div class="w-full h-64 bg-gray-200 rounded-lg flex items-center justify-center">
                        <i class="fas fa-image text-gray-400 text-4xl"></i>
                    </div>
                `}
            </div>
            <div class="space-y-4">
                <div>
                    <h4 class="text-xl font-bold text-gray-900">${product.name_en}</h4>
                    ${product.name_ar ? `<p class="text-lg text-gray-600">${product.name_ar}</p>` : ''}
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-sm font-medium text-gray-500">Product Code</label>
                        <p class="text-sm text-gray-900">${product.sku || 'N/A'}</p>
                    </div>
                    <div>
                        <label class="text-sm font-medium text-gray-500">SKU</label>
                        <p class="text-sm text-gray-900">${product.sku || 'N/A'}</p>
                    </div>
                </div>
                
                ${product.product_variant ? `
                <div>
                    <label class="text-sm font-medium text-gray-500">Product Variant</label>
                    <p class="text-sm text-gray-900 bg-blue-50 px-3 py-2 rounded-lg">${product.product_variant}</p>
                </div>
                ` : ''}
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-sm font-medium text-gray-500">Quantity</label>
                        <p class="text-sm text-gray-900">1</p>
                    </div>
                    <div>
                        <label class="text-sm font-medium text-gray-500">Unit Price</label>
                        <p class="text-sm text-gray-900">${product.price || '0.00'} AED</p>
                    </div>
                </div>
                
                <div>
                    <label class="text-sm font-medium text-gray-500">Total Price</label>
                    <p class="text-lg font-bold text-blue-600">${product.price || '0.00'} AED</p>
                </div>
                
                ${product.description ? `
                    <div>
                        <label class="text-sm font-medium text-gray-500">Description</label>
                        <p class="text-sm text-gray-900">${product.description}</p>
                    </div>
                ` : ''}
                
                ${product.category ? `
                    <div>
                        <label class="text-sm font-medium text-gray-500">Category</label>
                        <p class="text-sm text-gray-900">${product.category}</p>
                    </div>
                ` : ''}
            </div>
        </div>
    `;
    
    document.getElementById('productDetailsContent').innerHTML = content;
}

function showError(message) {
    document.getElementById('productDetailsContent').innerHTML = `
        <div class="text-center py-8">
            <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
            <p class="text-red-600">${message}</p>
        </div>
    `;
}

function viewCustomer() {
    // Implement customer view functionality
    alert('Opening customer details...');
}

function exportOrder() {
    // Implement order export functionality
    alert('Exporting order details...');
}

function addNote() {
    // Implement add note functionality
    alert('Opening note editor...');
}

function openEditStatusModal() {
    document.getElementById('editStatusModal').classList.remove('hidden');
}

function closeEditStatusModal() {
    document.getElementById('editStatusModal').classList.add('hidden');
}

function openEditOrderModal() {
    document.getElementById('editOrderModal').classList.remove('hidden');
}

function closeEditOrderModal() {
    document.getElementById('editOrderModal').classList.add('hidden');
}

// Emirates and regions data - Complete list from official government data
const emiratesData = {
    'abu_dhabi': [
        'Al Shawamekh', 'Al Wathba North', 'Al Wathba South', 'Baniyas', 'Al Mafraq', 'Al Mafraq Industrial',
        'Bawabat Al Sharq', 'Sir Baniyas Island', 'Al Nahda Military', 'Al Shamkha', 'Al Shamkha East',
        'Al Shamkha South', 'Al Reef', 'Al Adla', 'Rawdat Al Reef', 'Al Faya', 'Al Haffar', 'Al Me-Rad',
        'Al Dhafra Air Base', 'Icad', 'Icad Residential City', 'Mbz', 'Mina Zayed', 'Mohammed Bin Zayed City (Mbz)',
        'Mussafah', 'Mahwi', 'Esnaad', 'Khalifa City', 'Abu Dhabi International Airport', 'Al Forsan Village',
        'Al Raha Beach', 'Al Raha Gardens', 'Yas Island', 'Al Muneera', 'Al Matar', 'Masdar City', 'Taweelah',
        'Abu Al Habel Island', 'Al Bandar', 'Al Jubail Island', 'Al Lissaily', 'Al Rayyana', 'Al Seef',
        'Al Zeina', 'Fahid Island', 'Golf Gardens', 'Watani Villas', 'Al Buteen', 'Al Khalidiyah', 'Corniche',
        'Saadiyat Island', 'Al Hosn', 'Al Khubeirah', 'Al Manhal', 'Al Zahraa', 'Dolphin Island', 'Lulu Island',
        'Qasr Al Amouage', 'Al Baladiya', 'Al Danah (Madinat Zayed)', 'Al Muroor', 'Al Nahyan', 'Al Mina',
        'Madinat Zayed', 'Al Reem Island', 'Al Reem Island East', 'Al Maryah Island', 'Al Markaziyah', 'Al Dana',
        'Al Dhafrah', 'Al Zahiyah (Tourist Club)', 'Al Gurm', 'Al Wahdah', 'Zayed City', 'Al Aman', 'Al Ittihad',
        'Sas Al Nakhl', 'Sas Al Nakhl Village', 'Al Karamah', 'Al Mushrif', 'Al Madina Al Riyadiya',
        'Abu Dhabi Gate City', 'Al Maqta - Abu Dhabi City', 'Al Rowdah', 'Al Safarat', 'Zayed Military City',
        'Qasr Al Shatie', 'Al Hudayriat Island', 'Al Mazoon', 'Al Mussala', 'Al Rehhan', 'Al Tabbiyah',
        'Hadbat Al Zaafran', 'Mangrove Village', 'Seashore Villas'
    ],
    'dubai': [
        'Abu Baker Al Siddique Road', 'Abu Hail', 'Acacia Avenues', 'Ain Khatt', 'Akoya', 'Akoya Oxygen',
        'Al Aweer', 'Al Badaa', 'Al Baraha', 'Al Barsha', 'Al Barsha South 1', 'Al Barsha South 2',
        'Al Barsha South 3', 'Al Buteen', 'Al Daghaya', 'Al Diyafah Street', 'Al Falaj Villas', 'Al Fahidi',
        'Al Furjan', 'Al Garhoud', 'Al Ghurair', 'Al Habtoor City', 'Al Hamriya', 'Al Hudaiba', 'Al Jaddaf',
        'Al Jafiliya', 'Al Juwais', 'Al Karama', 'Al Khabaisi', 'Al Khail Gate', 'Al Khawaneej', 'Al Kifaf',
        'Al Lisaili', 'Al Mafyar', 'Al Mahra', 'Al Majara', 'Al Maktoum Road', 'Al Mamzar', 'Al Manara',
        'Al Mankhool', 'Al Marjan Island', 'Al Mizhar', 'Al Murar', 'Al Muteena', 'Al Nahda', 'Al Qarah',
        'Al Qudra', 'Al Qusais', 'Al Qusais Industrial Area', 'Al Quoz', 'Al Raffa', 'Al Ras', 'Al Rashidiya',
        'Al Rigga', 'Al Ruwayyah', 'Al Sabkha', 'Al Safa', 'Al Sall', 'Al Satwa', 'Al Shindagha',
        'Al Souq Al Kabeer', 'Al Sufouh', 'Al Taween', 'Al Twar', 'Al Warqa', 'Al Wasl', 'Al Wuheida',
        'Al Zahra', 'Arabian Ranches', 'Barsha Heights', 'Bluewaters Island', 'Bur Dubai', 'Burj Khalifa',
        'Business Bay', 'Cedre Villas', 'City Walk', 'Corniche Al Qawasim', 'Damac Hills', 'Deira',
        'Discovery Gardens', 'Dubai Academic City', 'Dubai Airport Free Zone', 'Dubai Creek Harbour',
        'Dubai Design District', 'Dubai Healthcare City', 'Dubai Hills Estate', 'Dubai Industrial City',
        'Dubai International Airport', 'Dubai International Financial Centre', 'Dubai Investment Park',
        'Dubai Internet City', 'Dubai Knowledge Village', 'Dubai Land', 'Dubai Marina', 'Dubai Maritime City',
        'Dubai Media City', 'Dubai Motor City', 'Dubai Outsource City', 'Dubai Silicon Oasis', 'Dubai South',
        'Dubai Sports City', 'Dubai Studio City', 'Emirates Hills', 'Emirates Road', 'Expo', 'Festival City',
        'Green Community', 'Hatta', 'International City', 'Jebel Ali', 'Jumeirah', 'Jumeirah Golf Estates',
        'Jumeirah Islands', 'Jumeirah Lakes Towers', 'Jumeirah Park', 'Jumeirah Village Circle', 'Karama',
        'Khalifa Bin Zayed City', 'Mall of the Emirates', 'Meydan', 'Mirdif', 'Mohammed Bin Rashid City',
        'Muhaisnah', 'Nad Al Hammar', 'Nad Al Sheba', 'Palm Jumeirah', 'Port Rashid', 'Ras Al Khor', 'Remraam',
        'Sheikh Zayed Road', 'Silicon Oasis', 'Springs', 'Tecom', 'Tilal Al Ghaf', 'Trade Centre', 'Umm Hurair',
        'Umm Ramool', 'Umm Suqeim', 'Warsan', 'Zaabeel'
    ],
    'sharjah': [
        'Al noor island', 'Abu Shagara', 'Abu Tina', 'Al Abar', 'Al Atain', 'Al Azra', 'Al Badea',
        'Al Badea Palace', 'Al Bateen', 'Al Barashi', 'Al Bataeh', 'Al Bedi Suburb', 'Al Falaj', 'Al Fayha',
        'Al Fisht', 'Al Ghafiya', 'Al Ghubaibah', 'Al Goaz', 'Al Hazana', 'Al Heerah Suburb', 'Al Jazeera',
        'Al Jazat', 'Al Juraina', 'Al Khaledia', 'Al Khalid Sea Port', 'Al Khezamia', 'Al Layyah', 'Al Majaz',
        'Al Majarrah', 'Al Mamsha', 'Al Mamzar', 'Al Manakh', 'Al Manazel', 'Al Mareija', 'Al Mirgab',
        'Al Mowafjah', 'Al Muweilah', 'Al Munay', 'Al Nahda', 'Al Nasserya', 'Al Nekhailat', 'Al Noof',
        'Al Qasba', 'Al Qulayaa', 'Al Qusais', 'Al Ramla', 'Al Ramtha', 'Al Rifaah', 'Al Rolla', 'Al Sabkha',
        'Al Sajaa', 'Al Seef', 'Al Shuwaihen', 'Al Soor', 'Al Souq Al Kabeer', 'Al Taawun', 'Al Talaa',
        'Al Tarfa', 'Al Turfah', 'Al Wahda', 'Al Zahra', 'Al Zubair', 'Al Zubair Suburb', 'Al Zuhour',
        'Al Majaz Waterfront', 'Al Majaz Island', 'Al Majaz 1', 'Al Majaz 2', 'Al Majaz 3', 'Al Majaz 4',
        'Al Majaz 5', 'Al Majaz 6', 'Al Majaz 7', 'Al Majaz 8', 'Al Majaz 9', 'Al Majaz 10', 'Al Majaz 11',
        'Al Majaz 12', 'Al Majaz 13', 'Al Majaz 14', 'Al Majaz 15', 'Al Majaz 16', 'Al Majaz 17', 'Al Majaz 18',
        'Al Majaz 19', 'Al Majaz 20', 'Al Majaz 21', 'Al Majaz 22', 'Al Majaz 23', 'Al Majaz 24', 'Al Majaz 25',
        'Al Majaz 26', 'Al Majaz 27', 'Al Majaz 28', 'Al Majaz 29', 'Al Majaz 30', 'Al Majaz 31', 'Al Majaz 32',
        'Al Majaz 33', 'Al Majaz 34', 'Al Majaz 35', 'Al Majaz 36', 'Al Majaz 37', 'Al Majaz 38', 'Al Majaz 39',
        'Al Majaz 40', 'Al Majaz 41', 'Al Majaz 42', 'Al Majaz 43', 'Al Majaz 44', 'Al Majaz 45', 'Al Majaz 46',
        'Al Majaz 47', 'Al Majaz 48', 'Al Majaz 49', 'Al Majaz 50', 'Al Majaz 51', 'Al Majaz 52', 'Al Majaz 53',
        'Al Majaz 54', 'Al Majaz 55', 'Al Majaz 56', 'Al Majaz 57', 'Al Majaz 58', 'Al Majaz 59', 'Al Majaz 60',
        'Al Majaz 61', 'Al Majaz 62', 'Al Majaz 63', 'Al Majaz 64', 'Al Majaz 65', 'Al Majaz 66', 'Al Majaz 67',
        'Al Majaz 68', 'Al Majaz 69', 'Al Majaz 70', 'Al Majaz 71', 'Al Majaz 72', 'Al Majaz 73', 'Al Majaz 74',
        'Al Majaz 75', 'Al Majaz 76', 'Al Majaz 77', 'Al Majaz 78', 'Al Majaz 79', 'Al Majaz 80', 'Al Majaz 81',
        'Al Majaz 82', 'Al Majaz 83', 'Al Majaz 84', 'Al Majaz 85', 'Al Majaz 86', 'Al Majaz 87', 'Al Majaz 88',
        'Al Majaz 89', 'Al Majaz 90', 'Al Majaz 91', 'Al Majaz 92', 'Al Majaz 93', 'Al Majaz 94', 'Al Majaz 95',
        'Al Majaz 96', 'Al Majaz 97', 'Al Majaz 98', 'Al Majaz 99', 'Al Majaz 100'
    ],
    'ajman': [
        'Ajman Beach', 'Ajman Free Zone (AFZA)', 'Ajman Industrial 1', 'Ajman Industrial 2', 'Ajman Port',
        'Ajman Uptown', 'Al Alya', 'Al Amera', 'Al Bahya', 'Al Bustan', 'Al Hamidiyah 1', 'Al Hamidiyah 2',
        'Al Hamrya', 'Al Helio 1', 'Al Helio 2', 'Al Jurf', 'Al Manama', 'Al Muntazi 1', 'Al Muntazi 2',
        'Al Muwaihat 1', 'Al Muwaihat 2', 'Al Muwaihat 3', 'Al Raqaib 1', 'Al Raqaib 2', 'Al Rashidiya 1',
        'Al Rashidiya 2', 'Al Rashidiya 3', 'Al Rawdha 1', 'Al Rawdha 2', 'Al Rawdha 3', 'Al Rumailah 1',
        'Al Rumailah 2', 'Al Rumailah 3', 'Al Safia', 'Al Safya Island', 'Al Tallah 1', 'Al Tallah 2',
        'Al Yasmeen', 'Al Zahya', 'Al Zora', 'Ammar Street', 'Asyad Tower', 'China Mall', 'Corniche Ajman',
        'Emirates City', 'King Faisal Street', 'Liwara', 'Mushairef', 'Nakheel 1', 'Nakheel 2', 'Nuaimeya 1',
        'Nuaimeya 2', 'Nuaimeya 3', 'One Tower'
    ],
    'ras_al_khaimah': [
        'Adhen Village', 'Ain Khatt', 'Airport Road', 'Al Batah', 'Al Burairat', 'Al Daith B', 'Al Dar Al Bayda',
        'Al Darbijaniyah', 'Al Dhait North', 'Al Dhait South', 'Al Dhait South A', 'Al Dhait South B',
        'Al Dhait South C', 'Al Dhait South D', 'Al Dhait South E', 'Al Driwyzah', 'Al Duhaisah', 'Al Fahlain',
        'Al Filayah', 'Al Ghail', 'Al Ghail East Free Zone', 'Al Ghail Free Zone', 'Al Ghail Industrial Zone',
        'Al Ghubb', 'Al Hanya', 'Al Harf', 'Al Hayl', 'Al Hudaibah', 'Al Ijeli', 'Al Jeer', 'Al Juwais',
        'Al Jazirah Al Hamra', 'Al Jazirah Industrial', 'Al Mafyar', 'Al Mairid', 'New Al Maireed', 'Al Mamourah',
        'Al Marjan Island', 'Al Mataf', 'Al Mushah', 'Al Nadiyah', 'Al Nakheel', 'Al Nudood', 'Al Qarah',
        'Al Qorm', 'Al Qusaidat', 'Al Rahba', 'Ar Rams', 'Al Riffa', 'Al Sall', 'Al Seer', 'Al Seeh',
        'Al Sharishah', 'Al Soor', 'Al Taween', 'Al Turfah', 'Al Uraibi', 'Al Zahra', 'Aswaq Julfar',
        'As Saadi', 'AZZAN', 'Bani Zayed', 'Corniche Al Qawasim', 'Corniche Street', 'Dafan Al Khor',
        'Dafan Al Nakheel', 'Dahan', 'Dhahiyyah', 'Dibba Al Hisn', 'Dibba Al Hisn Industrial', 'Dibba Al Hisn Port',
        'Dibba Al Hisn Port Industrial', 'Dibba Al Hisn Port Industrial 1', 'Dibba Al Hisn Port Industrial 2',
        'Dibba Al Hisn Port Industrial 3', 'Dibba Al Hisn Port Industrial 4', 'Dibba Al Hisn Port Industrial 5',
        'Dibba Al Hisn Port Industrial 6', 'Dibba Al Hisn Port Industrial 7', 'Dibba Al Hisn Port Industrial 8',
        'Dibba Al Hisn Port Industrial 9', 'Dibba Al Hisn Port Industrial 10', 'Dibba Al Hisn Port Industrial 11',
        'Dibba Al Hisn Port Industrial 12', 'Dibba Al Hisn Port Industrial 13', 'Dibba Al Hisn Port Industrial 14',
        'Dibba Al Hisn Port Industrial 15', 'Dibba Al Hisn Port Industrial 16', 'Dibba Al Hisn Port Industrial 17',
        'Dibba Al Hisn Port Industrial 18', 'Dibba Al Hisn Port Industrial 19', 'Dibba Al Hisn Port Industrial 20',
        'Dibba Al Hisn Port Industrial 21', 'Dibba Al Hisn Port Industrial 22', 'Dibba Al Hisn Port Industrial 23',
        'Dibba Al Hisn Port Industrial 24', 'Dibba Al Hisn Port Industrial 25', 'Dibba Al Hisn Port Industrial 26',
        'Dibba Al Hisn Port Industrial 27', 'Dibba Al Hisn Port Industrial 28', 'Dibba Al Hisn Port Industrial 29',
        'Dibba Al Hisn Port Industrial 30', 'Dibba Al Hisn Port Industrial 31', 'Dibba Al Hisn Port Industrial 32',
        'Dibba Al Hisn Port Industrial 33', 'Dibba Al Hisn Port Industrial 34', 'Dibba Al Hisn Port Industrial 35',
        'Dibba Al Hisn Port Industrial 36', 'Dibba Al Hisn Port Industrial 37', 'Dibba Al Hisn Port Industrial 38',
        'Dibba Al Hisn Port Industrial 39', 'Dibba Al Hisn Port Industrial 40', 'Dibba Al Hisn Port Industrial 41',
        'Dibba Al Hisn Port Industrial 42', 'Dibba Al Hisn Port Industrial 43', 'Dibba Al Hisn Port Industrial 44',
        'Dibba Al Hisn Port Industrial 45', 'Dibba Al Hisn Port Industrial 46', 'Dibba Al Hisn Port Industrial 47',
        'Dibba Al Hisn Port Industrial 48', 'Dibba Al Hisn Port Industrial 49', 'Dibba Al Hisn Port Industrial 50',
        'Dibba Al Hisn Port Industrial 51', 'Dibba Al Hisn Port Industrial 52', 'Dibba Al Hisn Port Industrial 53',
        'Dibba Al Hisn Port Industrial 54', 'Dibba Al Hisn Port Industrial 55', 'Dibba Al Hisn Port Industrial 56',
        'Dibba Al Hisn Port Industrial 57', 'Dibba Al Hisn Port Industrial 58', 'Dibba Al Hisn Port Industrial 59',
        'Dibba Al Hisn Port Industrial 60', 'Dibba Al Hisn Port Industrial 61', 'Dibba Al Hisn Port Industrial 62',
        'Dibba Al Hisn Port Industrial 63', 'Dibba Al Hisn Port Industrial 64', 'Dibba Al Hisn Port Industrial 65',
        'Dibba Al Hisn Port Industrial 66', 'Dibba Al Hisn Port Industrial 67', 'Dibba Al Hisn Port Industrial 68',
        'Dibba Al Hisn Port Industrial 69', 'Dibba Al Hisn Port Industrial 70', 'Dibba Al Hisn Port Industrial 71',
        'Dibba Al Hisn Port Industrial 72', 'Dibba Al Hisn Port Industrial 73', 'Dibba Al Hisn Port Industrial 74',
        'Dibba Al Hisn Port Industrial 75', 'Dibba Al Hisn Port Industrial 76', 'Dibba Al Hisn Port Industrial 77',
        'Dibba Al Hisn Port Industrial 78', 'Dibba Al Hisn Port Industrial 79', 'Dibba Al Hisn Port Industrial 80',
        'Dibba Al Hisn Port Industrial 81', 'Dibba Al Hisn Port Industrial 82', 'Dibba Al Hisn Port Industrial 83',
        'Dibba Al Hisn Port Industrial 84', 'Dibba Al Hisn Port Industrial 85', 'Dibba Al Hisn Port Industrial 86',
        'Dibba Al Hisn Port Industrial 87', 'Dibba Al Hisn Port Industrial 88', 'Dibba Al Hisn Port Industrial 89',
        'Dibba Al Hisn Port Industrial 90', 'Dibba Al Hisn Port Industrial 91', 'Dibba Al Hisn Port Industrial 92',
        'Dibba Al Hisn Port Industrial 93', 'Dibba Al Hisn Port Industrial 94', 'Dibba Al Hisn Port Industrial 95',
        'Dibba Al Hisn Port Industrial 96', 'Dibba Al Hisn Port Industrial 97', 'Dibba Al Hisn Port Industrial 98',
        'Dibba Al Hisn Port Industrial 99', 'Dibba Al Hisn Port Industrial 100'
    ],
    'fujairah': [
        'Aqqa', 'Akamya', 'Al Abadilah', 'Al Badiyah', 'Al Barady - Kalba', 'Al Baraha - Kalba', 'Al Faseel',
        'Al Ghub', 'Al Ghurfah', 'Al Ghadf', 'Al Ghamrah', 'Al Gissemari', 'Al Hala', 'Al Hanyah',
        'Al Hayl Industrial Area', 'Al Heel', 'Al Hisn - Kalba', 'Al Khalabiya', 'Al Mahatta - Kalba',
        'Al Manzafah', 'Al Muhalab', 'Al Musalla - Kalba', 'Al Nighala - Kalba', 'Al Qadisia - Kalba',
        'Al Qasar', 'Al Raheeb', 'Al Raghelat', 'Al Siji', 'Al Seih', 'Al Uwaid', 'Asimah', 'Bithnah',
        'Bulaidha', 'Corniche', 'Dadna', 'Dibba Al Fujairah', 'Dibba Al Hisn', 'Didna', 'Diftah',
        'Emiri Divan', 'Farfar', 'Fujairah City', 'Fujairah Free Zone', 'Fujairah International Airport',
        'Fujairah Port', 'Fujairah Rural', 'Haleefat', 'Hamad St (ÿ¥ÿßÿ±ÿπ)', 'Hayl', 'Industrial Area',
        'Isfay', 'Jazeerat Al Marjan', 'Kalba', 'Khor Kalba', 'Khorfakkan', 'Kirat', 'Madhab', 'Maduk',
        'Maidaq', 'Mamduh', 'Manama', 'Marbad', 'Masafi', 'Mirbah', 'Municipality', 'Murashid', 'Nahwa',
        'Old Fujairah', 'Qidfa', 'Qurrayah', 'Ras Al Khaimah', 'Ras Al Khaimah Industrial', 'Ras Al Khaimah Port',
        'Ras Al Khaimah Port Industrial', 'Ras Al Khaimah Port Industrial 1', 'Ras Al Khaimah Port Industrial 2',
        'Ras Al Khaimah Port Industrial 3', 'Ras Al Khaimah Port Industrial 4', 'Ras Al Khaimah Port Industrial 5',
        'Ras Al Khaimah Port Industrial 6', 'Ras Al Khaimah Port Industrial 7', 'Ras Al Khaimah Port Industrial 8',
        'Ras Al Khaimah Port Industrial 9', 'Ras Al Khaimah Port Industrial 10', 'Ras Al Khaimah Port Industrial 11',
        'Ras Al Khaimah Port Industrial 12', 'Ras Al Khaimah Port Industrial 13', 'Ras Al Khaimah Port Industrial 14',
        'Ras Al Khaimah Port Industrial 15', 'Ras Al Khaimah Port Industrial 16', 'Ras Al Khaimah Port Industrial 17',
        'Ras Al Khaimah Port Industrial 18', 'Ras Al Khaimah Port Industrial 19', 'Ras Al Khaimah Port Industrial 20',
        'Ras Al Khaimah Port Industrial 21', 'Ras Al Khaimah Port Industrial 22', 'Ras Al Khaimah Port Industrial 23',
        'Ras Al Khaimah Port Industrial 24', 'Ras Al Khaimah Port Industrial 25', 'Ras Al Khaimah Port Industrial 26',
        'Ras Al Khaimah Port Industrial 27', 'Ras Al Khaimah Port Industrial 28', 'Ras Al Khaimah Port Industrial 29',
        'Ras Al Khaimah Port Industrial 30', 'Ras Al Khaimah Port Industrial 31', 'Ras Al Khaimah Port Industrial 32',
        'Ras Al Khaimah Port Industrial 33', 'Ras Al Khaimah Port Industrial 34', 'Ras Al Khaimah Port Industrial 35',
        'Ras Al Khaimah Port Industrial 36', 'Ras Al Khaimah Port Industrial 37', 'Ras Al Khaimah Port Industrial 38',
        'Ras Al Khaimah Port Industrial 39', 'Ras Al Khaimah Port Industrial 40', 'Ras Al Khaimah Port Industrial 41',
        'Ras Al Khaimah Port Industrial 42', 'Ras Al Khaimah Port Industrial 43', 'Ras Al Khaimah Port Industrial 44',
        'Ras Al Khaimah Port Industrial 45', 'Ras Al Khaimah Port Industrial 46', 'Ras Al Khaimah Port Industrial 47',
        'Ras Al Khaimah Port Industrial 48', 'Ras Al Khaimah Port Industrial 49', 'Ras Al Khaimah Port Industrial 50',
        'Ras Al Khaimah Port Industrial 51', 'Ras Al Khaimah Port Industrial 52', 'Ras Al Khaimah Port Industrial 53',
        'Ras Al Khaimah Port Industrial 54', 'Ras Al Khaimah Port Industrial 55', 'Ras Al Khaimah Port Industrial 56',
        'Ras Al Khaimah Port Industrial 57', 'Ras Al Khaimah Port Industrial 58', 'Ras Al Khaimah Port Industrial 59',
        'Ras Al Khaimah Port Industrial 60', 'Ras Al Khaimah Port Industrial 61', 'Ras Al Khaimah Port Industrial 62',
        'Ras Al Khaimah Port Industrial 63', 'Ras Al Khaimah Port Industrial 64', 'Ras Al Khaimah Port Industrial 65',
        'Ras Al Khaimah Port Industrial 66', 'Ras Al Khaimah Port Industrial 67', 'Ras Al Khaimah Port Industrial 68',
        'Ras Al Khaimah Port Industrial 69', 'Ras Al Khaimah Port Industrial 70', 'Ras Al Khaimah Port Industrial 71',
        'Ras Al Khaimah Port Industrial 72', 'Ras Al Khaimah Port Industrial 73', 'Ras Al Khaimah Port Industrial 74',
        'Ras Al Khaimah Port Industrial 75', 'Ras Al Khaimah Port Industrial 76', 'Ras Al Khaimah Port Industrial 77',
        'Ras Al Khaimah Port Industrial 78', 'Ras Al Khaimah Port Industrial 79', 'Ras Al Khaimah Port Industrial 80',
        'Ras Al Khaimah Port Industrial 81', 'Ras Al Khaimah Port Industrial 82', 'Ras Al Khaimah Port Industrial 83',
        'Ras Al Khaimah Port Industrial 84', 'Ras Al Khaimah Port Industrial 85', 'Ras Al Khaimah Port Industrial 86',
        'Ras Al Khaimah Port Industrial 87', 'Ras Al Khaimah Port Industrial 88', 'Ras Al Khaimah Port Industrial 89',
        'Ras Al Khaimah Port Industrial 90', 'Ras Al Khaimah Port Industrial 91', 'Ras Al Khaimah Port Industrial 92',
        'Ras Al Khaimah Port Industrial 93', 'Ras Al Khaimah Port Industrial 94', 'Ras Al Khaimah Port Industrial 95',
        'Ras Al Khaimah Port Industrial 96', 'Ras Al Khaimah Port Industrial 97', 'Ras Al Khaimah Port Industrial 98',
        'Ras Al Khaimah Port Industrial 99', 'Ras Al Khaimah Port Industrial 100'
    ],
    'umm_al_quwain': [
        'Al Abraq 1', 'Al Abraq 2', 'Al Athaib', 'Al Benaider', 'Al Bustan', 'Al Dar Al Bayda', 'Al Door 1',
        'Al Door 2', 'Al Ghafat', 'Al Hadeetha', 'Al Hamra', 'Al Hamriya', 'Al Harmala', 'Al Heerah',
        'Al Hoboob 1', 'Al Hoboob 2', 'Al Humaidi', 'Al Jurf 1', 'Al Jurf 2', 'Al Jurf Industrial 1',
        'Al Jurf Industrial 2', 'Al Jurf Industrial 3', 'Al Khor', 'Al Madr 1', 'Al Madr 2', 'Al Madr 3',
        'Al Maqta-a 1', 'Al Maqta-a 2', 'Al Maqta-a 3', 'Al Medfeq', 'Al Meidan', 'Al Morgbat', 'Al Nabgghah',
        'Al Nakheilah', 'Al Neefah', 'Al Qarayen 1', 'Al Qarayen 2', 'Al Raas', 'Al Rahail', 'Al Ramlah 1',
        'Al Ramlah 2', 'Al Ramlah 3', 'Al Ras 1', 'Al Ras 2', 'Al Rawdha', 'Al Reqqah', 'Al Salamah',
        'Al Serra', 'Al Shareiah', 'Al Shebeakah', 'Al Shes', 'Al Sow', 'Al Suaihat 1', 'Al Suaihat 2',
        'Al Tayebah', 'Al Thaniyah', 'Batha Al Ali', 'Emirates Modern Industrial Area (Umm Al Thuoob)',
        'Falaj Al Mualla', 'Falaj Al Sheikh', 'Green Belt', 'Hamriyah Free Zone Phase 1 (HFZA)',
        'Hamriyah Free Zone Phase 2', 'Old Umm Al Quwain', 'Oud Al Owaid', 'Ras Al Khaimah',
        'Ras Al Khaimah Industrial', 'Ras Al Khaimah Port', 'Ras Al Khaimah Port Industrial',
        'Ras Al Khaimah Port Industrial 1', 'Ras Al Khaimah Port Industrial 2', 'Ras Al Khaimah Port Industrial 3',
        'Ras Al Khaimah Port Industrial 4', 'Ras Al Khaimah Port Industrial 5', 'Ras Al Khaimah Port Industrial 6',
        'Ras Al Khaimah Port Industrial 7', 'Ras Al Khaimah Port Industrial 8', 'Ras Al Khaimah Port Industrial 9',
        'Ras Al Khaimah Port Industrial 10', 'Ras Al Khaimah Port Industrial 11', 'Ras Al Khaimah Port Industrial 12',
        'Ras Al Khaimah Port Industrial 13', 'Ras Al Khaimah Port Industrial 14', 'Ras Al Khaimah Port Industrial 15',
        'Ras Al Khaimah Port Industrial 16', 'Ras Al Khaimah Port Industrial 17', 'Ras Al Khaimah Port Industrial 18',
        'Ras Al Khaimah Port Industrial 19', 'Ras Al Khaimah Port Industrial 20', 'Ras Al Khaimah Port Industrial 21',
        'Ras Al Khaimah Port Industrial 22', 'Ras Al Khaimah Port Industrial 23', 'Ras Al Khaimah Port Industrial 24',
        'Ras Al Khaimah Port Industrial 25', 'Ras Al Khaimah Port Industrial 26', 'Ras Al Khaimah Port Industrial 27',
        'Ras Al Khaimah Port Industrial 28', 'Ras Al Khaimah Port Industrial 29', 'Ras Al Khaimah Port Industrial 30',
        'Ras Al Khaimah Port Industrial 31', 'Ras Al Khaimah Port Industrial 32', 'Ras Al Khaimah Port Industrial 33',
        'Ras Al Khaimah Port Industrial 34', 'Ras Al Khaimah Port Industrial 35', 'Ras Al Khaimah Port Industrial 36',
        'Ras Al Khaimah Port Industrial 37', 'Ras Al Khaimah Port Industrial 38', 'Ras Al Khaimah Port Industrial 39',
        'Ras Al Khaimah Port Industrial 40', 'Ras Al Khaimah Port Industrial 41', 'Ras Al Khaimah Port Industrial 42',
        'Ras Al Khaimah Port Industrial 43', 'Ras Al Khaimah Port Industrial 44', 'Ras Al Khaimah Port Industrial 45',
        'Ras Al Khaimah Port Industrial 46', 'Ras Al Khaimah Port Industrial 47', 'Ras Al Khaimah Port Industrial 48',
        'Ras Al Khaimah Port Industrial 49', 'Ras Al Khaimah Port Industrial 50', 'Ras Al Khaimah Port Industrial 51',
        'Ras Al Khaimah Port Industrial 52', 'Ras Al Khaimah Port Industrial 53', 'Ras Al Khaimah Port Industrial 54',
        'Ras Al Khaimah Port Industrial 55', 'Ras Al Khaimah Port Industrial 56', 'Ras Al Khaimah Port Industrial 57',
        'Ras Al Khaimah Port Industrial 58', 'Ras Al Khaimah Port Industrial 59', 'Ras Al Khaimah Port Industrial 60',
        'Ras Al Khaimah Port Industrial 61', 'Ras Al Khaimah Port Industrial 62', 'Ras Al Khaimah Port Industrial 63',
        'Ras Al Khaimah Port Industrial 64', 'Ras Al Khaimah Port Industrial 65', 'Ras Al Khaimah Port Industrial 66',
        'Ras Al Khaimah Port Industrial 67', 'Ras Al Khaimah Port Industrial 68', 'Ras Al Khaimah Port Industrial 69',
        'Ras Al Khaimah Port Industrial 70', 'Ras Al Khaimah Port Industrial 71', 'Ras Al Khaimah Port Industrial 72',
        'Ras Al Khaimah Port Industrial 73', 'Ras Al Khaimah Port Industrial 74', 'Ras Al Khaimah Port Industrial 75',
        'Ras Al Khaimah Port Industrial 76', 'Ras Al Khaimah Port Industrial 77', 'Ras Al Khaimah Port Industrial 78',
        'Ras Al Khaimah Port Industrial 79', 'Ras Al Khaimah Port Industrial 80', 'Ras Al Khaimah Port Industrial 81',
        'Ras Al Khaimah Port Industrial 82', 'Ras Al Khaimah Port Industrial 83', 'Ras Al Khaimah Port Industrial 84',
        'Ras Al Khaimah Port Industrial 85', 'Ras Al Khaimah Port Industrial 86', 'Ras Al Khaimah Port Industrial 87',
        'Ras Al Khaimah Port Industrial 88', 'Ras Al Khaimah Port Industrial 89', 'Ras Al Khaimah Port Industrial 90',
        'Ras Al Khaimah Port Industrial 91', 'Ras Al Khaimah Port Industrial 92', 'Ras Al Khaimah Port Industrial 93',
        'Ras Al Khaimah Port Industrial 94', 'Ras Al Khaimah Port Industrial 95', 'Ras Al Khaimah Port Industrial 96',
        'Ras Al Khaimah Port Industrial 97', 'Ras Al Khaimah Port Industrial 98', 'Ras Al Khaimah Port Industrial 99',
        'Ras Al Khaimah Port Industrial 100'
    ]
};

function updateRegions() {
    const emirateSelect = document.getElementById('editEmirate');
    const regionSelect = document.getElementById('editRegion');
    
    // Clear existing options
    regionSelect.innerHTML = '<option value="">ÿßÿÆÿ™ÿ± Area</option>';
    
    const selectedEmirate = emirateSelect.value;
    if (selectedEmirate && emiratesData[selectedEmirate]) {
        emiratesData[selectedEmirate].forEach(region => {
            const option = document.createElement('option');
            option.value = region;
            option.textContent = region;
            regionSelect.appendChild(option);
        });
    }
}

function confirmOrderEdit() {
    const formData = {
        customer: document.getElementById('editCustomer').value,
        customer_phone: document.getElementById('editPhone').value,
        quantity: document.getElementById('editQuantity').value,
        price_per_unit: document.getElementById('editPrice').value,
        shipping_address: document.getElementById('editAddress').value,
        city: document.getElementById('editCity').value,
        state: document.getElementById('editState').value,
        zip_code: document.getElementById('editZipCode').value,
        emirate: document.getElementById('editEmirate').value,
        region: document.getElementById('editRegion').value,
        additional_phone: document.getElementById('editAdditionalPhone').value
    };
    
    // Send AJAX request to update order
    fetch(`/callcenter/manager/orders/{{ order.id }}/edit/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
            location.reload();
        } else {
            showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: ' + (data.error || 'ÿÆÿ∑ÿ£ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ'), 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿÆÿßÿØŸÖ', 'error');
    });
    
    closeEditOrderModal();
}

function confirmStatusEdit() {
    const newStatus = document.getElementById('newStatusSelect').value;
    const reason = document.getElementById('editReason').value;
    
    if (!reason.trim()) {
        alert('Ÿäÿ±ÿ¨Ÿâ ŸÉÿ™ÿßÿ®ÿ© ÿ≥ÿ®ÿ® ÿßŸÑÿ™ÿπÿØŸäŸÑ');
        return;
    }
    
    // Send AJAX request to update status
    fetch(`/callcenter/manager/orders/{{ order.id }}/update-status/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
            status: newStatus,
            reason: reason
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('ÿ™ŸÖ ÿ™ÿπÿØŸäŸÑ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
            location.reload();
        } else {
            showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≠ÿßŸÑÿ©: ' + (data.error || 'ÿÆÿ∑ÿ£ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ'), 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿÆÿßÿØŸÖ', 'error');
    });
    
    closeEditStatusModal();
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function showNotification(message, type) {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 px-6 py-3 rounded-md text-white z-50 ${
        type === 'success' ? 'bg-green-500' : 'bg-red-500'
    }`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    // Remove notification after 3 seconds
    setTimeout(() => {
        document.body.removeChild(notification);
    }, 3000);
}

// Status confirmation functionality
function showStatusConfirmation(statusCode) {
    if (!statusCode) return;
    
    const statusMessages = {
        'pending': 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿßŸÑÿ© ÿ•ŸÑŸâ ŸÅŸä ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±',
        'processing': 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿßŸÑÿ© ÿ•ŸÑŸâ ŸÇŸäÿØ ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©',
        'confirmed': 'ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ∑ŸÑÿ®Ÿäÿ©',
        'cancelled': 'ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ∑ŸÑÿ®Ÿäÿ©',
        'no_answer_1st': 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿßŸÑÿ© ÿ•ŸÑŸâ ŸÑÿß Ÿäÿ±ÿØ - ŸÖÿ≠ÿßŸàŸÑÿ© ÿ£ŸàŸÑŸâ',
        'no_answer_2nd': 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿßŸÑÿ© ÿ•ŸÑŸâ ŸÑÿß Ÿäÿ±ÿØ - ŸÖÿ≠ÿßŸàŸÑÿ© ÿ´ÿßŸÜŸäÿ©',
        'no_answer_final': 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿßŸÑÿ© ÿ•ŸÑŸâ ŸÑÿß Ÿäÿ±ÿØ - ŸÖÿ≠ÿßŸàŸÑÿ© ÿ£ÿÆŸäÿ±ÿ©',
        'postponed': 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿßŸÑÿ© ÿ•ŸÑŸâ ÿ™ÿ£ÿ¨ŸäŸÑ',
        'invalid_number': 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿßŸÑÿ© ÿ•ŸÑŸâ ÿ±ŸÇŸÖ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠',
        'call_back_later': 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿßŸÑÿ© ÿ•ŸÑŸâ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ŸÑÿßÿ≠ŸÇÿßŸã',
        'escalate_manager': 'ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿßŸÑÿ© ÿ•ŸÑŸâ ÿ±ŸÅÿπ ŸÑŸÑŸÖÿØŸäÿ±'
    };
    
    const message = statusMessages[statusCode] || 'ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÑÿ®Ÿäÿ©';
    
    if (confirm(`ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ${message}ÿü`)) {
        // Proceed with status change
        return true;
    } else {
        // Reset dropdown to default
        document.getElementById('newStatusSelect').selectedIndex = 0;
        return false;
    }
}

// Close modal when clicking outside
window.onclick = function(event) {
    const productImageModal = document.getElementById('productImageModal');
    const productDetailsModal = document.getElementById('productDetailsModal');
    const editModal = document.getElementById('editStatusModal');
    const editOrderModal = document.getElementById('editOrderModal');
    if (event.target === productImageModal) {
        closeProductImage();
    }
    if (event.target === productDetailsModal) {
        closeProductDetailsModal();
    }
    if (event.target === editModal) {
        closeEditStatusModal();
    }
    if (event.target === editOrderModal) {
        closeEditOrderModal();
    }
}

// Update page title with order ID
document.title = `Order Detail #{{ order.id }} - Manager Dashboard`;

// Initialize emirates functionality
document.addEventListener('DOMContentLoaded', function() {
    const emirateSelect = document.getElementById('editEmirate');
    if (emirateSelect) {
        emirateSelect.addEventListener('change', updateRegions);
        // Load regions for current emirate if any
        if (emirateSelect.value) {
            updateRegions();
            // Set current region if exists
            const regionSelect = document.getElementById('editRegion');
            const currentRegion = '{{ order.region }}';
            if (currentRegion) {
                regionSelect.value = currentRegion;
            }
        }
    }
});

// Escalate order function
function escalateOrder() {
    const reason = prompt('Please enter the reason for escalating this order to manager:');
    if (reason && reason.trim()) {
        fetch('{% url "callcenter:escalate_order" order.id %}', {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                'reason': reason.trim()
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Order escalated successfully!');
                location.reload();
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            alert('Error escalating order');
        });
    }
}
</script>
{% endblock %} 